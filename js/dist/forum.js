(()=>{var t={n:s=>{var o=s&&s.__esModule?()=>s.default:()=>s;return t.d(o,{a:o}),o},d:(s,o)=>{for(var e in o)t.o(o,e)&&!t.o(s,e)&&Object.defineProperty(s,e,{enumerable:!0,get:o[e]})},o:(t,s)=>Object.prototype.hasOwnProperty.call(t,s),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},s={};(()=>{"use strict";t.r(s);const o=flarum.core.compat["forum/app"];var e=t.n(o);function n(t,s){return n=Object.setPrototypeOf||function(t,s){return t.__proto__=s,t},n(t,s)}function a(t,s){t.prototype=Object.create(s.prototype),t.prototype.constructor=t,n(t,s)}const i=flarum.core.compat["components/EventPost"];var r=t.n(i);const l=flarum.core.compat["common/components/LoadingIndicator"];var c=t.n(l);const u=flarum.core.compat["common/components/Link"];var d=t.n(u),p=function(t){function s(){return t.apply(this,arguments)||this}a(s,t);var o=s.prototype;return o.oninit=function(s){t.prototype.oninit.call(this,s),this.loadDupe()},o.icon=function(){return"fas fa-flag"},o.descriptionKey=function(){return"blomstra-flag-duplicates.forum.post_stream.flagged_duplicate_text"},o.descriptionData=function(){var t={};return t.duplicate=this.dupe?m(d(),{href:e().route.discussion(this.dupe)},this.dupe.title()):m(c(),{size:"small",display:"inline"}),t},o.loadDupe=function(){var t=this,s=this.attrs.post.content();e().store.find("discussions",s).then((function(s){t.dupe=s,m.redraw()}))},s}(r());const f=flarum.core.compat["common/extend"],h=flarum.core.compat["flags/forum/components/FlagPostModal"];var g=t.n(h);const v=flarum.core.compat["forum/components/Post"];var y=t.n(v);const b=flarum.core.compat["common/helpers/icon"];var D=t.n(b);const _=flarum.extensions["fof-merge-discussions"],x=flarum.core.compat["common/components/Button"];var P=t.n(x);const S=flarum.core.compat["forum/utils/DiscussionControls"];var k=t.n(S);const w=flarum.core.compat["common/Component"];var M=t.n(w);const O=flarum.core.compat["common/utils/withAttr"];var j=t.n(O);const B=flarum.core.compat["forum/states/GlobalSearchState"];var F=t.n(B),L=function(t){function s(){for(var s,o=arguments.length,e=new Array(o),n=0;n<o;n++)e[n]=arguments[n];return(s=t.call.apply(t,[this].concat(e))||this).search=void 0,s}a(s,t);var o=s.prototype;return o.oninit=function(s){t.prototype.oninit.call(this,s),this.state={selectedDiscussion:null}},o.oncreate=function(s){t.prototype.oncreate.call(this,s)},o.view=function(){var t,s,o=this,n=this.attrs.discussion;return this.search=new(F()),m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"duplicate"===this.attrs.reason(),value:"duplicate",onclick:j()("value",this.attrs.reason)}),m("strong",null,e().translator.trans("blomstra-flag-duplicates.forum.flags.reason_duplicate_label")),e().translator.trans("blomstra-flag-duplicates.forum.flags.reason_duplicate_text"),"duplicate"===this.attrs.reason()&&m("div",{class:"FlagPostModal-DuplicateSearch","data-result-selected":!!this.state.selectedDiscussion},m(_.components.DiscussionSearch,{state:this.search,onSelect:function(t){o.state.selectedDiscussion=t,o.attrs.reasonDetail(t.id()),m.redraw()}.bind(this),ignore:n.id()}),m("div",{class:"FlagPostModal-SelectedDuplicate"},m(P(),{class:"Button Button--icon",icon:"fas fa-trash","aria-label":e().translator.trans("blomstra-flag-duplicates.forum.flags.deselect_discussion_a11y_label"),onclick:function(){o.state.selectedDiscussion=null,o.attrs.reasonDetail("")}}),m("span",null,null==(t=this.state.selectedDiscussion)?void 0:t.id()," ~ ",null==(s=this.state.selectedDiscussion)?void 0:s.title()))))},s}(M());e().initializers.add("blomstra/flag-duplicates",(function(){e().postComponents.discussionFlaggedDuplicate=p,(0,f.extend)(g().prototype,"flagReasons",(function(t){var s;if(1===(null==(s=this.attrs.post)?void 0:s.number())&&!this.success){var o=this.attrs.post.discussion();t.add("duplicate",m(L,{discussion:o,reason:this.reason,reasonDetail:this.reasonDetail}),100)}})),(0,f.extend)(g().prototype,["oncreate","onupdate"],(function(){var t;1===(null==(t=this.attrs.post)?void 0:t.number())&&(this.$(".Search-clear").attr("type","button"),this.$(".Button[type=submit]").prop("disabled","duplicate"===this.reason()&&!this.reasonDetail()||!this.reason()))})),(0,f.extend)(y().prototype,"flagActionItems",(function(t){var s,o=this;(null==(s=this.attrs.post)||null==s.flags?void 0:s.flags()).map((function(s){if("duplicate"===(null==s||null==s.reason?void 0:s.reason())){var n=o.attrs.post.discussion();t.remove("controls"),t.add("merge",m(P(),{className:"Button",icon:"fas fa-code-branch fa-flip-vertical",disabled:!o.dupeDiscussion,onclick:function(){e().modal.show(_.components.DiscussionMergeModal,{discussion:n,preselect:o.dupeDiscussion})}},e().translator.trans("fof-merge-discussions.forum.discussion.merge")),5)}}))})),(0,f.override)(y().prototype,"flagReason",(function(t,s){var o=t(s);if("duplicate"===(null==s||null==s.reason?void 0:s.reason())){if(this.flagsLoading||!this.dupeDiscussion)return o[1]=m("span",{className:"Post-flagged-detail"},m(c(),{size:"small",display:"inline"})),o;var n=e().route.discussion(this.dupeDiscussion);return o[1]=m("span",{className:"Post-flagged-detail"},m(d(),{href:n,external:!0,target:"_blank"},this.dupeDiscussion.title()||e().translator.trans("blomstra-flag-duplicates.forum.flags.duplicate_discussion")," ",D()("fas fa-external-link-alt")," ")),o}return o})),(0,f.extend)(y().prototype,"oninit",(function(){var t,s=this;null==(t=this.subtree)||t.check((function(){var t;return null==(t=s.dupeDiscussion)?void 0:t.freshness}))})),(0,f.extend)(y().prototype,["oninit","onupdate"],(function(t){var s,o=this,n=null==(s=this.attrs.post)||null==s.flags?void 0:s.flags();n&&(this.flagsLoading=!0,n.map((function(t){if("duplicate"===(null==t||null==t.reason?void 0:t.reason())){var s=e().store.getById("discussion",t.reasonDetail());s?o.dupeDiscussion=s:e().store.find("discussions",t.reasonDetail()).then((function(t){o.dupeDiscussion=t}))}})),this.flagsLoading=!1)})),(0,f.extend)(k(),"userControls",(function(t,s){var o=s.firstPost();o&&!o.isHidden()&&"comment"===o.contentType()&&o.canFlag()&&t.add("flag-dupe",m(P(),{icon:"fas fa-flag",onclick:function(){return e().modal.show(g(),{post:o})}},e().translator.trans("flarum-flags.forum.post_controls.flag_button")),0)}))}))})(),module.exports=s})();
//# sourceMappingURL=forum.js.map