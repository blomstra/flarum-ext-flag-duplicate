module.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=18)}([function(e,t){e.exports=flarum.core.compat["forum/app"]},function(e,t){e.exports=flarum.core.compat["common/extend"]},function(e,t){e.exports=flarum.core.compat["flags/forum/components/FlagPostModal"]},function(e,t){e.exports=flarum.core.compat["common/components/Button"]},function(e,t){e.exports=flarum.core.compat["forum/components/Post"]},,function(e,t){e.exports=flarum.core.compat["common/components/LoadingIndicator"]},function(e,t){e.exports=flarum.core.compat["common/components/Link"]},function(e,t){e.exports=flarum.extensions["fof-merge-discussions"]},function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.isTraversal=void 0;var a=/^[^\\#]?(?:\\(?:[\da-f]{1,6}\s?|.)|[\w\-\u00b0-\uFFFF])+/,s=/\\([\da-f]{1,6}\s?|(\s)|.)/gi,o=new Map([["~","element"],["^","start"],["$","end"],["*","any"],["!","not"],["|","hyphen"]]),i={">":"child","<":"parent","~":"sibling","+":"adjacent"},c={"#":["id","equals"],".":["class","element"]},l=new Set(["has","not","matches","is","where","host","host-context"]),u=new Set(r(["descendant"],Object.keys(i).map((function(e){return i[e]})),!0)),f=new Set(["accept","accept-charset","align","alink","axis","bgcolor","charset","checked","clear","codetype","color","compact","declare","defer","dir","direction","disabled","enctype","face","frame","hreflang","http-equiv","lang","language","link","media","method","multiple","nohref","noresize","noshade","nowrap","readonly","rel","rev","rules","scope","scrolling","selected","shape","target","text","type","valign","valuetype","vlink"]);function p(e){return u.has(e.type)}t.isTraversal=p;var d=new Set(["contains","icontains"]),h=new Set(['"',"'"]);function m(e,t,n){var r=parseInt(t,16)-65536;return r!=r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,1023&r|56320)}function v(e){return e.replace(s,m)}function g(e){return" "===e||"\n"===e||"\t"===e||"\f"===e||"\r"===e}function y(e,t){if(e.length>0&&0===t.length)throw new Error("Empty sub-selector");e.push(t)}t.default=function(e,t){var n=[],r=function e(t,n,r,s){var u,m;void 0===r&&(r={});var b=[],w=!1;function x(e){var t=n.slice(s+e).match(a);if(!t)throw new Error("Expected name, found "+n.slice(s));var r=t[0];return s+=e+r.length,v(r)}function A(e){for(;g(n.charAt(s+e));)e++;s+=e}function _(e){for(var t=0;"\\"===n.charAt(--e);)t++;return 1==(1&t)}function D(){if(b.length>0&&p(b[b.length-1]))throw new Error("Did not expect successive traversals.")}A(0);for(;""!==n;){var j=n.charAt(s);if(g(j))w=!0,A(1);else if(j in i)D(),b.push({type:i[j]}),w=!1,A(1);else if(","===j){if(0===b.length)throw new Error("Empty sub-selector");t.push(b),b=[],w=!1,A(1)}else if(n.startsWith("/*",s)){var O=n.indexOf("*/",s+2);if(O<0)throw new Error("Comment was not terminated");s=O+2}else if(w&&(D(),b.push({type:"descendant"}),w=!1),j in c){var C=c[j],P=C[0],S=C[1];b.push({type:"attribute",name:P,action:S,value:x(1),namespace:null,ignoreCase:!!r.xmlMode&&null})}else if("["===j){A(1);var M=null;"|"===n.charAt(s)&&(M="",s+=1),n.startsWith("*|",s)&&(M="*",s+=2);var E=x(0);null===M&&"|"===n.charAt(s)&&"="!==n.charAt(s+1)&&(M=E,E=x(1)),(null!==(u=r.lowerCaseAttributeNames)&&void 0!==u?u:!r.xmlMode)&&(E=E.toLowerCase()),A(0);S="exists";var k=o.get(n.charAt(s));if(k){if(S=k,"="!==n.charAt(s+1))throw new Error("Expected `=`");A(2)}else"="===n.charAt(s)&&(S="equals",A(1));var L="",F=null;if("exists"!==S){if(h.has(n.charAt(s))){for(var B=n.charAt(s),q=s+1;q<n.length&&(n.charAt(q)!==B||_(q));)q+=1;if(n.charAt(q)!==B)throw new Error("Attribute value didn't end");L=v(n.slice(s+1,q)),s=q+1}else{for(var N=s;s<n.length&&(!g(n.charAt(s))&&"]"!==n.charAt(s)||_(s));)s+=1;L=v(n.slice(N,s))}A(0);var T=n.charAt(s);"s"===T||"S"===T?(F=!1,A(1)):"i"!==T&&"I"!==T||(F=!0,A(1))}if(r.xmlMode||null!=F||(F=f.has(E)),"]"!==n.charAt(s))throw new Error("Attribute selector didn't terminate");s+=1;var W={type:"attribute",name:E,action:S,value:L,namespace:M,ignoreCase:F};b.push(W)}else if(":"===j){if(":"===n.charAt(s+1)){b.push({type:"pseudo-element",name:x(2).toLowerCase()});continue}var I=x(1).toLowerCase(),z=null;if("("===n.charAt(s))if(l.has(I)){if(h.has(n.charAt(s+1)))throw new Error("Pseudo-selector "+I+" cannot be quoted");if(s=e(z=[],n,r,s+1),")"!==n.charAt(s))throw new Error("Missing closing parenthesis in :"+I+" ("+n+")");s+=1}else{for(var $=s+=1,R=1;R>0&&s<n.length;s++)"("!==n.charAt(s)||_(s)?")"!==n.charAt(s)||_(s)||R--:R++;if(R)throw new Error("Parenthesis not matched");if(z=n.slice($,s-1),d.has(I)){var G=z.charAt(0);G===z.slice(-1)&&h.has(G)&&(z=z.slice(1,-1)),z=v(z)}}b.push({type:"pseudo",name:I,data:z})}else{M=null;var H=void 0;if("*"===j)s+=1,H="*";else{if(!a.test(n.slice(s)))return b.length&&"descendant"===b[b.length-1].type&&b.pop(),y(t,b),s;"|"===n.charAt(s)&&(M="",s+=1),H=x(0)}"|"===n.charAt(s)&&(M=H,"*"===n.charAt(s+1)?(H="*",s+=2):H=x(1)),"*"===H?b.push({type:"universal",namespace:M}):((null!==(m=r.lowerCaseTags)&&void 0!==m?m:!r.xmlMode)&&(H=H.toLowerCase()),b.push({type:"tag",name:H,namespace:M}))}}return y(t,b),s}(n,""+e,t,0);if(r<e.length)throw new Error("Unmatched selector: "+e.slice(r));return n}},function(e,t){e.exports=flarum.core.compat["components/EventPost"]},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},s=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.stringify=t.parse=void 0,a(n(9),t);var o=n(9);Object.defineProperty(t,"parse",{enumerable:!0,get:function(){return s(o).default}});var i=n(17);Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return s(i).default}})},function(e,t){e.exports=flarum.core.compat["common/helpers/icon"]},function(e,t){e.exports=flarum.core.compat["forum/utils/DiscussionControls"]},function(e,t){e.exports=flarum.core.compat["common/Component"]},function(e,t){e.exports=flarum.core.compat["common/utils/withAttr"]},function(e,t){e.exports=flarum.core.compat["forum/states/GlobalSearchState"]},function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,s=t.length;a<s;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0});var a={equals:"",element:"~",start:"^",end:"$",any:"*",not:"!",hyphen:"|"},s=new Set(r(r([],Object.keys(a).map((function(e){return a[e]})).filter(Boolean),!0),[":","[","]"," ","\\","(",")","'"],!1));function o(e){return e.map(i).join(", ")}function i(e){return e.map(c).join("")}function c(e){switch(e.type){case"child":return" > ";case"parent":return" < ";case"sibling":return" ~ ";case"adjacent":return" + ";case"descendant":return" ";case"universal":return u(e.namespace)+"*";case"tag":return l(e);case"pseudo-element":return"::"+f(e.name);case"pseudo":return null===e.data?":"+f(e.name):"string"==typeof e.data?":"+f(e.name)+"("+f(e.data)+")":":"+f(e.name)+"("+o(e.data)+")";case"attribute":if("id"===e.name&&"equals"===e.action&&!e.ignoreCase&&!e.namespace)return"#"+f(e.value);if("class"===e.name&&"element"===e.action&&!e.ignoreCase&&!e.namespace)return"."+f(e.value);var t=l(e);return"exists"===e.action?"["+t+"]":"["+t+a[e.action]+"='"+f(e.value)+"'"+(e.ignoreCase?"i":!1===e.ignoreCase?"s":"")+"]"}}function l(e){return""+u(e.namespace)+f(e.name)}function u(e){return null!==e?("*"===e?"*":f(e))+"|":""}function f(e){return e.split("").map((function(e){return s.has(e)?"\\"+e:e})).join("")}t.default=o},function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r);function s(e,t){return(s=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function o(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,s(e,t)}var i=n(10),c=n.n(i),l=n(6),u=n.n(l),f=n(7),p=n.n(f),d=function(e){function t(){return e.apply(this,arguments)||this}o(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t),this.loadDupe()},n.icon=function(){return"fas fa-flag"},n.descriptionKey=function(){return"blomstra-flag-duplicates.forum.post_stream.flagged_duplicate_text"},n.descriptionData=function(){var e={};return e.duplicate=this.dupe?m(p.a,{href:a.a.route.discussion(this.dupe)},this.dupe.title()):m(u.a,{size:"small",display:"inline"}),e},n.loadDupe=function(){var e=this,t=this.attrs.post.content();a.a.store.find("discussions",t).then((function(t){e.dupe=t,m.redraw()}))},t}(c.a),h=n(1),v=n(2),g=n.n(v),y=n(11);function b(e,t,n){return function e(t,n,r){var a;a=Array.isArray(t)?t:[t];var s=void 0;a.some((function(t){if("boolean"==typeof t||"number"==typeof t||"string"==typeof t||null==t)return!1;if(Array.isArray(t)){var a=e(t,n,r);return!!a&&(s=a,!0)}if(function(e,t){return t.some((function(t){return t.every((function(t){var n,r,a,s;switch(t.type){case"tag":return e.tag===t.name;case"attribute":if(!e.attrs)return!1;"class"===t.name&&(t.name="className");var o=e.attrs[t.name];switch("className"===t.name&&"string"==typeof o&&(o=o.trim()),t.ignoreCase&&"string"==typeof o&&(o=o.toLowerCase(),t.value=t.value.toLowerCase()),t.action){case"exists":return e.attrs.hasOwnProperty(t.name);case"equals":return o===t.value;case"start":return(null==(n=o)||null==n.startsWith?void 0:n.startsWith(t.value))||!1;case"end":return(null==(r=o)||null==r.endsWith?void 0:r.endsWith(t.value))||!1;case"element":return(null==(a=o)||null==a.split||null==(s=a.split(" "))||null==s.includes?void 0:s.includes(t.value))||!1}}return!1}))}))}(t,n))return s=t,!0;if(Array.isArray(t.children)){var o=e(t.children,n);return!!o&&(s=o,!0)}return!1})),r&&s&&r(s);return s}(e,Object(y.parse)(t),n)}var w=n(4),x=n.n(w),A=n(12),_=n.n(A),D=n(8),j=n(3),O=n.n(j),C=n(13),P=n.n(C),S=n(14),M=n.n(S),E=n(15),k=n.n(E),L=n(16),F=n.n(L),B=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return(t=e.call.apply(e,[this].concat(r))||this).search=void 0,t}o(t,e);var n=t.prototype;return n.oninit=function(t){e.prototype.oninit.call(this,t),this.state={selectedDiscussion:null}},n.oncreate=function(t){e.prototype.oncreate.call(this,t)},n.view=function(){var e,t,n=this,r=this.attrs.discussion;return this.search=new F.a,m("label",{className:"checkbox"},m("input",{type:"radio",name:"reason",checked:"duplicate"===this.attrs.reason(),value:"duplicate",onclick:k()("value",this.attrs.reason)}),m("strong",null,a.a.translator.trans("blomstra-flag-duplicates.forum.flags.reason_duplicate_label")),a.a.translator.trans("blomstra-flag-duplicates.forum.flags.reason_duplicate_text"),"duplicate"===this.attrs.reason()&&m("div",{class:"FlagPostModal-DuplicateSearch","data-result-selected":!!this.state.selectedDiscussion},m(D.components.DiscussionSearch,{state:this.search,onSelect:function(e){n.state.selectedDiscussion=e,n.attrs.reasonDetail(e.id()),m.redraw()}.bind(this),ignore:r.id()}),m("div",{class:"FlagPostModal-SelectedDuplicate"},m(O.a,{class:"Button Button--icon",icon:"fas fa-trash","aria-label":a.a.translator.trans("blomstra-flag-duplicates.forum.flags.deselect_discussion_a11y_label"),onclick:function(){n.state.selectedDiscussion=null,n.attrs.reasonDetail("")}}),m("span",null,null==(e=this.state.selectedDiscussion)?void 0:e.id()," ~ ",null==(t=this.state.selectedDiscussion)?void 0:t.title()))))},t}(M.a);a.a.initializers.add("blomstra/flag-duplicates",(function(){a.a.postComponents.discussionFlaggedDuplicate=d,g.a.prototype.flagReasons?Object(h.extend)(g.a.prototype,"flagReasons",(function(e){var t;if(1===(null==(t=this.attrs.post)?void 0:t.number())&&!this.success){var n=this.attrs.post.discussion();e.add("duplicate",m(B,{discussion:n,reason:this.reason,reasonDetail:this.reasonDetail}),100)}})):Object(h.extend)(g.a.prototype,"content",(function(e){var t,n=this;1!==(null==(t=this.attrs.post)?void 0:t.number())||this.success||b(e,".Form-group",(function(e){var t=n.attrs.post.discussion();e.children[0].children.splice(0,0,m(B,{discussion:t,reason:n.reason,reasonDetail:n.reasonDetail}))}))})),Object(h.extend)(g.a.prototype,["oncreate","onupdate"],(function(){var e;1===(null==(e=this.attrs.post)?void 0:e.number())&&(this.$(".Search-clear").attr("type","button"),this.$(".Button[type=submit]").prop("disabled","duplicate"===this.reason()&&!this.reasonDetail()||!this.reason()))})),Object(h.extend)(x.a.prototype,"flagActionItems",(function(e){var t,n=this;(null==(t=this.attrs.post)||null==t.flags?void 0:t.flags()).map((function(t){if("duplicate"===(null==t||null==t.reason?void 0:t.reason())){var r=n.attrs.post.discussion();e.remove("controls"),e.add("merge",m(O.a,{className:"Button",icon:"fas fa-code-branch fa-flip-vertical",disabled:!n.dupeDiscussion,onclick:function(){a.a.modal.show(D.components.DiscussionMergeModal,{discussion:r,preselect:n.dupeDiscussion})}},a.a.translator.trans("fof-merge-discussions.forum.discussion.merge")),5)}}))})),Object(h.override)(x.a.prototype,"flagReason",(function(e,t){var n=e(t);if("duplicate"===(null==t||null==t.reason?void 0:t.reason())){if(this.flagsLoading||!this.dupeDiscussion)return n[1]=m("span",{className:"Post-flagged-detail"},m(u.a,{size:"small",display:"inline"})),n;var r=a.a.route.discussion(this.dupeDiscussion);return n[1]=m("span",{className:"Post-flagged-detail"},m(p.a,{href:r,external:!0,target:"_blank"},this.dupeDiscussion.title()||a.a.translator.trans("blomstra-flag-duplicates.forum.flags.duplicate_discussion")," ",_()("fas fa-external-link-alt")," ")),n}return n})),Object(h.extend)(x.a.prototype,"oninit",(function(){var e,t=this;null==(e=this.subtree)||e.check((function(){var e;return null==(e=t.dupeDiscussion)?void 0:e.freshness}))})),Object(h.extend)(x.a.prototype,["oninit","onupdate"],(function(e){var t,n=this,r=null==(t=this.attrs.post)||null==t.flags?void 0:t.flags();r&&(this.flagsLoading=!0,r.map((function(e){if("duplicate"===(null==e||null==e.reason?void 0:e.reason())){var t=a.a.store.getById("discussion",e.reasonDetail());t?n.dupeDiscussion=t:a.a.store.find("discussions",e.reasonDetail()).then((function(e){n.dupeDiscussion=e}))}})),this.flagsLoading=!1)})),Object(h.extend)(P.a,"userControls",(function(e,t){var n=t.firstPost();n&&!n.isHidden()&&"comment"===n.contentType()&&n.canFlag()&&e.add("flag-dupe",m(O.a,{icon:"fas fa-flag",onclick:function(){return a.a.modal.show(g.a,{post:n})}},a.a.translator.trans("flarum-flags.forum.post_controls.flag_button")),0)}))}))}]);
//# sourceMappingURL=forum.js.map